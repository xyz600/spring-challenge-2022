# spring-challenge-2022

## ルール（日本語訳）

### 目的

モンスターの攻撃から自分の基地を守り、相手より長生きしよう。

### ルール

両プレイヤーは3体のヒーローからなるチームを操作します。
両チームはマップの反対側の隅にある拠点付近からスタートします。
ゲーム中、マップの端には定期的にモンスターが出現します。
モンスターが自分の拠点に到達すると、ダメージを受けます。
自分の拠点がダメージを受けすぎると負けとなります。

ありがたいことに、ヒーローはモンスターを退治することができます。

### マップ

ゲームは、座標X=0, Y=0を左上のピクセル、X=17630, Y=9000を右下のピクセルとする長方形のマップ上で行われます。
各拠点は破壊される前に最大3ポイントのダメージを受けることができます。

### ヒーロー

毎ターン、あなたは各ヒーローにコマンドを与えなければなりません。以下のコマンドのいずれかを実行することができます。

* WAIT（待機）：ヒーローはその場にとどまります。
* MOVE（移動）：移動の後にマップの座標を入力すると、ヒーローはその地点に向かって最大800ユニット前進します。

ヒーローの移動フェイズ後、800ユニット以内にいるモンスターは2ポイントのダメージを受けます。

### モンスター

すべてのモンスターは、一定の体力を持って登場します。ターン終了時に、モンスターの体力が0以下になった場合、そのモンスターはゲームから除外されます。
モンスターはランダムに出現し、移動方向もランダムです。
モンスターは常に1ターンに400ユニットの速度で一直線に進みます。
ターン終了時に拠点から5000ユニット以内にモンスターがいた場合、その拠点をターゲットにします。
拠点を狙った場合、モンスターはその拠点に向かって直進し、マップから離れることができなくなります。
ターン終了時に拠点から300ユニット以内にモンスターがいた場合、そのターンに殺されていない限り、そのモンスターは消滅し、拠点に1ポイントのダメージを与える。

### 勝敗

* 勝利条件
  * 相手の基礎体力が0になった。
  * 220ターン経過した時点で、あなたの基礎体力が相手より多いこと。
* 敗北条件
  * あなたのベースの体力が0になった。
  * あなたのプログラムが有効なコマンドを時間内に提供しなかった。

### 🐞デバッグのヒント

* エンティティにカーソルを合わせると、そのエンティティに関する詳細な情報が表示されます。
* コマンドの後にテキストを追加すると、そのテキストがヒーローの上に表示されます。
* ビューアの歯車のアイコンを押すと、追加の表示オプションにアクセスできます。
* キーボードでアクションを操作する：スペースで再生/一時停止、矢印で1フレームずつ進む

## 参加記

(1日目)

### wood2 league

* 脅威になる敵のうち、一番近くにいるキャラを殴り続ける
* 一度ターゲットにしたキャラは、消えるまで覚え続ける

### 覚えておくべきこと

* 一見直線状に来てないように見える monster も threat 判定喰らうことがある
  * ルールでいうところの「ターン終了時に拠点から5000ユニット以内にモンスターがいた場合、その拠点をターゲットにします」が働いているせいだとわかった
  * 割と threat_state が便利だとわかりつつある
* 何か時間経過と共に敵の体力が増加し続けているように見える
  * 一人で殴り続けても無理があるから、複数人で協調して殴らないといけないように見える？
* 敵キャラクターが何ターンで自軍につくかは正確に計算したいところ
  * 明らかに間に合わないなら、技を使うなり応援を頼むなりできそう

### wood1 league

* 序盤で敵を押し付けられるよりも、終盤で押し付けられる方がとても辛い
* 序盤は自分の陣地近辺でマナを生成することに徹して、後半で2人がかりで蜘蛛を wind し続ける戦略を試してみたい

(2日目)

### 強そうな戦略

* 序盤はマナをたくさん貯める
  * 何をするにもマナは必要
  * 適当なターン数で分岐
* 割り当ては、距離の総和が一番小さいのを選ぶ
* (防御) monster の到着までに間に合わなければ `Wind` を使う
  * 到着までに狩れるかどうかの判定を入れる
    * 毎ターン距離400詰める
    * 300 unit圏内に入れば攻撃
    * 相手が自陣 300 unit 圏内に入ったターンに倒されない
* (攻撃) 相手の陣地に入らない monster を相手陣地に入れる wind をする
  * 角度とタイミングが重要
    * 攻撃2人 : 水平 or 垂直から interleave 周期で投げ続ける
    * 防御1人 : 細かいことはせず、切る＋ギリギリになったら wind
      * 防御魔法かけられたら防御手薄だと厳しそうだけど、同じことはこっちの攻撃にも言えるので、速く攻撃ができればよい
  * 1回 wind したらもう二度としない
    * あんまり付きまとっても、HPが削られてしまうので

### wood1 league 最終戦略

* 序盤80ターンはマナを貯め続ける
* 攻撃2人、防御1人
* 補助情報
  * 陣地が左右で異なることで座標の取り扱いが異なるのが面倒だったので、常に左にいるように点対称に変換してから渡すことにした

### bronze

* 全ルール解法
  * control と defense

### ルールの確認

* スペルは、hero id が小さい順に適用されていく
* 複数の control を同時に受けたら、平均値に落ちる
* 同時に wind を受けたら、全部効果が適用される
* shield は、shield の重ね掛けも無効化する
* shield がかかったキャラに spell を打っても、マナを消費してしまう
* ライフがタイの場合は、自陣外での獲得マナの過多で勝敗が決まる
  * wild mana と呼ばれるらしい
* コマンドの順番が決まっている
  * `Control` -> `Shield` -> `Move hero` -> 攻撃＋マナ回復判定 -> `Wind` -> `Move monster` -> `shield countdown` -> monster appear / disappear
  * hero と monster の動きは同じじゃなかったのか…要修正

### 強そうな戦略

* 敵キャラが複数いた時、一番マナが溜まる位置を見つけてそこに動く
* 自陣で control した時、相手の陣地の端を狙って飛ばす
* 相手ディフェンスを吹き飛ばしたり control したりして、攻撃を阻害する
* 相手陣地に 侵入することがわかっている monster に defense をかける
  * 端にいるほど良いけど、どうなんだろう
* wind する時、相手の淵ぎりぎりを狙う
  * 同時に wind されることを防ぎたい
* defense 側は、相手が wind してくると思ったら自分も wind をしないと負け確になる
  * さっさと wind をするという選択もありかもしれない

### バグ修正

* defense の際、wind する条件などを一番近い target に限定していたが、全員に対して確認しないといけない

### 対戦環境の構築

* コドゲのサーバーが重すぎるので、現状の AI に対する勝率が知りたいと思っても色々難しい
* という訳で、時間もあるので対戦環境を作ることにする
